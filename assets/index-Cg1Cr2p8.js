var g=Object.defineProperty;var d=(o,e,t)=>e in o?g(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var l=(o,e,t)=>d(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();class p{constructor(e,t,i){l(this,"tile");l(this,"mergeTile");this.element=e,this.row=t,this.col=i}get getRow(){return this.row}get getCol(){return this.col}get getTile(){return this.tile}get getElement(){return this.element}set setTile(e){this.tile=e,this.tile&&(this.tile.setCol=this.col,this.tile.setRow=this.row)}get getMergeTile(){return this.mergeTile}canCombine(e){return!this.tile||this.mergeTile==null&&this.tile.getValue===e.getValue}mergeTiles(){if(!(this.tile==null||this.mergeTile==null))return this.tile.setValue=this.tile.getValue+this.mergeTile.getValue,this.mergeTile.remove(),this.mergeTile=void 0,this.tile.waitForTransition().then(()=>{var e;(e=this.tile)==null||e.setClass("merged")}),this.tile.getValue}set setMergeTile(e){this.mergeTile=e,e!=null&&(this.mergeTile.setCol=this.col,this.mergeTile.setRow=this.row)}}class R{constructor(e,t){l(this,"WRAPPER_SIZE",600);l(this,"SPACING",8);l(this,"GRID_SIZE",4);l(this,"BORDER_RADIUS",4);l(this,"cells",[]);l(this,"wrapperElement");this.wrapperElement=e,this.GRID_SIZE=t,this.wrapperElement.style.setProperty("--wrapper-size",`${this.WRAPPER_SIZE}px`),this.wrapperElement.style.setProperty("--spacing",`${this.SPACING}px`),this.wrapperElement.style.setProperty("--grid-size",`${this.GRID_SIZE}`),this.wrapperElement.style.setProperty("--border-radius",`${this.BORDER_RADIUS}px`);const i=this.WRAPPER_SIZE/this.GRID_SIZE-this.SPACING;this.wrapperElement.style.setProperty("--cell-size",`${i}px`),this.wrapperElement.style.setProperty("--bg-alpha","1"),this.wrapperElement.style.setProperty("--text-alpha","1"),this.cells=w(e,this.GRID_SIZE).map((s,r)=>new p(s,r%this.GRID_SIZE,Math.floor(r/this.GRID_SIZE)))}get getCells(){return this.cells}get getEmptyCells(){return this.cells.filter(e=>!e.getTile)}get getRandomEmptyCells(){const e=this.getEmptyCells;return e[Math.random()*e.length|0]}get cellsByCols(){return this.cells.reduce((e,t)=>(e[t.getCol]=e[t.getCol]||[],e[t.getCol][t.getRow]=t,e),[])}get cellsByRows(){return this.cells.reduce((e,t)=>(e[t.getRow]=e[t.getRow]||[],e[t.getRow][t.getCol]=t,e),[])}}function w(o,e){return Array(e*e).fill(0).map(()=>{const t=document.createElement("div");return t.classList.add("cell"),o.append(t),t})}class m{constructor(e,t=Math.random()>=.5?2:4){l(this,"value");l(this,"col",0);l(this,"row",0);l(this,"element");l(this,"tileContainer");this.value=t,this.element=document.createElement("div"),this.element.classList.add("tile"),this.setValue=t,this.tileContainer=e,this.tileContainer.append(this.element)}get getValue(){return this.value}remove(){return this.element.remove()}waitForTransition(e=!1){return new Promise(t=>{this.element.addEventListener(e?"animationend":"transitionend",t,{once:!0})})}setClass(e){this.element.classList.add(e)}set setValue(e){this.value=e;const t=20+Math.log2(e)*8;this.element.style.setProperty("--bg-alpha",`${t}%`),this.element.style.setProperty("--text-alpha",t<=50?"80%":"15%"),this.element.setAttribute("x-data-value",`${this.value}`),this.value>Math.pow(2,6)&&this.element.classList.add("secondary")}set setRow(e){this.row=e,this.element.style.setProperty("--row",this.row.toString())}set setCol(e){this.col=e,this.element.style.setProperty("--col",this.col.toString())}}const n=class n{constructor(e,t=4,i){l(this,"grid");l(this,"element");l(this,"scoreElement");l(this,"score",0);var s;this.element=e,i?this.scoreElement=i:(i=document.createElement("h1"),i.innerText="Score: ",this.scoreElement=document.createElement("span"),i.append(this.scoreElement),(s=this.element.parentElement)==null||s.prepend(i)),this.scoreElement.innerText=this.score.toString(),this.grid=new R(this.element,t),this.attachEventListener(),this.generateRandomTiles(2)}attachEventListener(){window.addEventListener("keyup",this.inputHandler.bind(this),{once:!0})}generateRandomTiles(e=1){for(let t=0;t<e;t++){const i=this.grid.getRandomEmptyCells;i.setTile=new m(this.element)}}set setScore(e){var t;this.score=e,this.scoreElement.innerText=(t=this.score)==null?void 0:t.toString()}get getScore(){return this.score}async inputHandler(e){if(e.key&&![n.ARROW_DOWN,n.ARROW_UP,n.ARROW_LEFT,n.ARROW_RIGHT].includes(e.key))return this.attachEventListener();e.key===n.ARROW_UP&&await this.slideUp(),e.key===n.ARROW_DOWN&&await this.slideDown(),e.key===n.ARROW_RIGHT&&await this.slideRight(),e.key===n.ARROW_LEFT&&await this.slideLeft(),this.grid.getCells.forEach(i=>{this.setScore=this.getScore+(i.mergeTiles()||0)});const t=new m(this.element);if(this.grid.getRandomEmptyCells.setTile=t,!this.canMoveUp()&&!this.canMoveDown()&&!this.canMoveLeft()&&!this.canMoveRight()){t.waitForTransition(!0).then(()=>{alert("You lose")});return}this.attachEventListener()}slideUp(){if(this.canMoveUp())return this.slideTiles(this.grid.cellsByCols)}slideDown(){if(this.canMoveDown())return this.slideTiles(this.grid.cellsByCols.map(e=>[...e].reverse()))}slideLeft(){this.canMoveLeft()&&this.slideTiles(this.grid.cellsByRows)}slideRight(){this.canMoveRight()&&this.slideTiles(this.grid.cellsByRows.map(e=>[...e].reverse()))}slideTiles(e){return Promise.all(e.flatMap(t=>{const i=[];for(let s=1;s<t.length;s++){const r=t[s];if(r.getTile==null)continue;let a;for(let h=s-1;h>=0;h--){const u=t[h];if(!u.canCombine(r.getTile))break;a=u}a&&(i.push(r.getTile.waitForTransition()),a.getTile!=null?a.setMergeTile=r.getTile:a.setTile=r.getTile,r.setTile=void 0)}return i}))}canMoveUp(){return this.canMove(this.grid.cellsByCols)}canMoveDown(){return this.canMove(this.grid.cellsByCols.map(e=>[...e].reverse()))}canMoveLeft(){return this.canMove(this.grid.cellsByRows)}canMoveRight(){return this.canMove(this.grid.cellsByRows.map(e=>[...e].reverse()))}canMove(e){return e.some(t=>t.some((i,s)=>s===0||i.getTile==null?!1:t[s-1].canCombine(i.getTile)))}};l(n,"ARROW_UP","ArrowUp"),l(n,"ARROW_DOWN","ArrowDown"),l(n,"ARROW_RIGHT","ArrowRight"),l(n,"ARROW_LEFT","ArrowLeft");let c=n;document.querySelector("#app").innerHTML=`
<div class="score-wrapper">
Score : <span id="score" class="score"></span>
</div>
<div id="248-wrapper" class="grid-wrapper"/>
`;const f=document.getElementById("248-wrapper"),y=document.getElementById("score")||void 0,T=new c(f,4,y);window.controller=T;
